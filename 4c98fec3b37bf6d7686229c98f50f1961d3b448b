---
type: research
timestamp: '2025-12-19T11:01:38.629290+00:00'
summary: 'git-notes-memory architecture: 16 modules, service layer pattern'
---

Explored git-notes-memory codebase structure:

**Core Services (Singleton Pattern)**:
- CaptureService: Memory capture with fcntl file locking
- RecallService: Semantic search via sqlite-vec KNN
- SyncService: Index synchronization with git notes
- IndexService: SQLite + sqlite-vec for vector search
- EmbeddingService: Lazy-loaded sentence-transformers (all-MiniLM-L6-v2)

**Data Flow**:
- Capture: validate → lock → YAML serialize → git notes append → embed → index
- Recall: embed query → KNN search → filter → hydrate (SUMMARY/FULL/FILES)

**Key Design Decisions**:
- Git notes as source of truth (refs/notes/mem/{namespace})
- Index is derived, can be rebuilt with reindex(full=True)
- 10 namespaces: inception, elicitation, research, decisions, progress, blockers, reviews, learnings, retrospective, patterns
- All models are frozen dataclasses for immutability

---
type: research
timestamp: '2025-12-19T11:01:38.645456+00:00'
summary: 'git-notes-memory test suite: 910 tests, 93.65% coverage'
---

Test suite analysis:

**Coverage by Module**:
- test_patterns.py: 135 tests (detection, classification, lifecycle)
- test_lifecycle.py: 115 tests (status transitions, compression)
- test_search.py: 100 tests (caching, expansion, reranking)
- test_index.py: 91 tests (CRUD, vector search, statistics)
- test_sync.py: 91 tests (reindex, consistency, repair)

**Testing Patterns**:
- Singleton reset via conftest.py autouse fixture
- MagicMock for service isolation
- Integration tests with real git repos (marked @pytest.mark.integration)
- Slow tests marked with @pytest.mark.slow

**Quality Gates**:
- make quality runs: format → lint → typecheck → security → coverage
- 80% minimum coverage enforced
- mypy --strict for full type checking

---
type: research
timestamp: '2025-12-19T11:01:38.664391+00:00'
summary: 'Claude Code plugin structure: 5 commands, 2 hooks, 1 skill'
---

Plugin integration points:

**Commands** (./commands/):
- /memory:capture - Store memories with namespace detection
- /memory:recall - Semantic search with context extraction
- /memory:search - Advanced filtering (semantic vs text)
- /memory:status - System health and statistics
- /memory:sync - Index synchronization modes

**Hooks** (./hooks/):
- Stop: Auto-sync index on session end (enabled)
- UserPromptSubmit: Capture [remember]/[capture] markers (disabled by default)

**Skill** (./skills/memory-recall/):
- Auto-triggers on past decision/learning queries
- Extracts concepts from conversation context
- Configurable threshold (0.7 default) and limit (3 default)

**Data Locations**:
- Git notes: refs/notes/mem/{namespace}
- SQLite index: ~/.local/share/memory-plugin/index.db
- Model cache: ~/.local/share/memory-plugin/models/
