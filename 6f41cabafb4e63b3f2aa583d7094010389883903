---
type: decisions
timestamp: '2025-12-24T20:18:11.984043+00:00'
summary: '...better:'
---

...better:

**The UserPromptSubmit hook detects markers in YOUR messages, not MINE.**

When you write `[decision] something` or `[learned] something` in your prompts, it gets detected. But the `▶ progress...

---
type: decisions
timestamp: '2025-12-24T20:18:12.023207+00:00'
summary: '...**UserPromptSubmit hook** (real-time): Detects markers in YOUR messages
  (e.g., when you type `[de'
---

...**UserPromptSubmit hook** (real-time): Detects markers in YOUR messages (e.g., when you type `[decision] something`)

2. **Stop hook** (session end): Analyzes the full transcript including MY messages...

---
type: decisions
timestamp: '2025-12-24T20:18:12.046733+00:00'
summary: Fix status command to use project-specific index path
---

Fix status command to use project-specific index path
## Context
The `/memory:status` command was reporting 0 memories because it used `get_index_path()` (global legacy path) instead of `get_project_index_path()` (current project-specific path).

## Rationale
- Per-project isolation was added to store indexes in `<git-root>/.memory/index.db`
- The status command wasn't updated to use this new path
- All memories (352) are safe in the project index

## Related Files
- commands/status.md:74,117
- src/git_notes_memory/config.py:185-193 (get_index_path)
- src/git_notes_memory/config.py:344-365 (get_project_index_path)

---
type: decisions
timestamp: '2025-12-25T21:44:33.319972+00:00'
summary: 'Confirmed: The `+` prefix in refspec is the standard solution'
---

Confirmed: The `+` prefix in refspec is the standard solution
## Summary
The Git documentation confirms that the `+` prefix in a refspec tells Git to update the reference even if it isn't a fast-forward.

## Rationale
- Current code: `f"{base}/*:{base}/*"` - fetches directly to local refs, fails on divergence
- Correct code: `f"+{base}/*:refs/notes/origin/mem/*"` - fetches to remote tracking refs with force-update
- The `+` prefix allows non-fast-forward updates which is necessary for notes that diverge across machines

## Related Files
- src/git_notes_memory/git_ops.py:731-742

---
type: decisions
timestamp: '2025-12-25T21:58:33.788785+00:00'
summary: 'Confirmed: The `+` prefix in refspec is the standard solution'
---

Confirmed: The `+` prefix in refspec is the standard solution
## Summary
The Git documentation confirms that the `+` prefix in a refspec tells Git to update the reference even if it isn't a fast-forward.

## Rationale
- Current code: `f"{base}/*:{base}/*"` - fetches directly to local refs, fails on divergence
- Correct code: `f"+{base}/*:refs/notes/origin/mem/*"` - fetches to remote tracking refs with force-update
- The `+` prefix allows non-fast-forward updates which is necessary for notes that diverge across machines

## Related Files
- src/git_notes_memory/git_ops.py:731-742

---
type: decisions
timestamp: '2025-12-25T21:59:56.093161+00:00'
summary: '▶ decision ─────────────────────────────────────

  Confirmed: The `+` prefix in refspec is the stan...'
tags:
- auto-captured
- pre-compact
---

Confirmed: The `+` prefix in refspec is the standard solution
## Summary
The Git documentation confirms that the `+` prefix in a refspec tells Git to update the reference even if it isn't a fast-forward.

## Rationale
- Current code: `f"{base}/*:{base}/*"` - fetches directly to local refs, fails on divergence
- Correct code: `f"+{base}/*:refs/notes/origin/mem/*"` - fetches to remote tracking refs with force-update
- The `+` prefix allows non-fast-forward updates which is necessary for notes that diverge across machines

## Related Files
- src/git_notes_memory/git_ops.py:731-742

---
type: decisions
timestamp: '2025-12-25T22:03:30.001128+00:00'
summary: 'Confirmed: The `+` prefix in refspec is the standard solution'
---

Confirmed: The `+` prefix in refspec is the standard solution
## Summary
The Git documentation confirms that the `+` prefix in a refspec tells Git to update the reference even if it isn't a fast-forward.

## Rationale
- Current code: `f"{base}/*:{base}/*"` - fetches directly to local refs, fails on divergence
- Correct code: `f"+{base}/*:refs/notes/origin/mem/*"` - fetches to remote tracking refs with force-update
- The `+` prefix allows non-fast-forward updates which is necessary for notes that diverge across machines

## Related Files
- src/git_notes_memory/git_ops.py:731-742

---
type: decisions
timestamp: '2025-12-25T22:03:30.070171+00:00'
summary: Approved specification for "Fix Git Notes Fetch Refspec"
---

Approved specification for "Fix Git Notes Fetch Refspec"
## Summary
Comprehensive specification addressing GitHub Issue #18 (git notes fetch refspec causing non-fast-forward errors) has been approved for implementation.

## Rationale
- **Complete documentation**: 1,876 lines across 6 documents
- **Clear solution**: Change fetch refspec from `refs/notes/mem/*:refs/notes/mem/*` to `+refs/notes/mem/*:refs/notes/origin/mem/*`
- **Zero-impact migration**: Auto-migrate on SessionStart hook
- **Opt-in auto-sync**: NEW hook-based fetch on start + push on stop (FR-104, FR-105)
- **Well-planned**: 18 tasks across 5 phases with clear dependencies
- **Test coverage**: Dedicated Phase 5 for comprehensive testing
- **7 ADRs** documenting all major decisions

## Related Files
- docs/spec/active/2025-12-25-fix-git-notes-fetch-refspec/README.md:5 (status updated)
- docs/spec/active/2025-12-25-fix-git-notes-fetch-refspec/CHANGELOG.md:5-10 (approval recorded)
- docs/spec/active/2025-12-25-fix-git-notes-fetch-refspec/APPROVAL_RECORD.md (audit trail created)

---
type: decisions
timestamp: '2025-12-25T23:34:25.625980+00:00'
summary: 'Confirmed: The `+` prefix in refspec is the standard solution'
---

Confirmed: The `+` prefix in refspec is the standard solution
## Summary
The Git documentation confirms that the `+` prefix in a refspec tells Git to update the reference even if it isn't a fast-forward.

## Rationale
- Current code: `f"{base}/*:{base}/*"` - fetches directly to local refs, fails on divergence
- Correct code: `f"+{base}/*:refs/notes/origin/mem/*"` - fetches to remote tracking refs with force-update
- The `+` prefix allows non-fast-forward updates which is necessary for notes that diverge across machines

## Related Files
- src/git_notes_memory/git_ops.py:731-742
