---
type: decisions
timestamp: '2025-12-21T06:03:28.815175+00:00'
summary: '...memories**: Use markers anywhere in your messages:'
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...

---
type: decisions
timestamp: '2025-12-21T06:03:28.831978+00:00'
summary: Git notes as source of truth, SQLite as derived queryable index
---

Git notes as source of truth, SQLite as derived queryable index
## Context
Core architectural decision for the memory storage system. Git notes provide distributed, versioned storage that syncs with code, while SQLite + sqlite-vec provides fast KNN search.

## Rationale
- Git notes are inherently distributed (push/pull with repos)
- Version history comes free with git
- Index can be rebuilt from notes (SyncService.reindex)
- sqlite-vec enables local semantic search without external APIs

## Related Files
- docs/spec/completed/2025-12-18-memory-capture-plugin/ARCHITECTURE.md:85-91
- src/git_notes_memory/git_ops.py:1-50
- src/git_notes_memory/sync.py:1-50

---
type: decisions
timestamp: '2025-12-21T06:03:28.850509+00:00'
summary: Lazy loading via __getattr__ to avoid embedding model import penalty
---

Lazy loading via __getattr__ to avoid embedding model import penalty
## Context
The sentence-transformers embedding model adds 2-3 seconds to import time. SessionStart hooks must complete quickly (<5s) to avoid blocking Claude Code sessions.

## Rationale
- Defer all expensive imports until first use
- Factory functions (`get_capture_service()`) create singletons lazily
- Direct SQLite queries in session_start_handler avoid full IndexService initialization

## Related Files
- src/git_notes_memory/__init__.py:27-85
- src/git_notes_memory/hooks/session_start_handler.py:66-89

---
type: decisions
timestamp: '2025-12-21T06:03:28.870963+00:00'
summary: Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
---

Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
## Context
When detecting capture-worthy content, the system needs to balance automation with user control.

## Rationale
- ≥0.95 confidence → AUTO (capture silently, show notification)
- 0.70-0.95 → SUGGEST (show suggestion, user confirms)
- <0.70 → SKIP (no action unless explicit marker)
- Explicit markers like `[decision]` always treated as confidence 0.98-1.0

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:226-265
- src/git_notes_memory/hooks/capture_decider.py:128-200

---
type: decisions
timestamp: '2025-12-21T06:03:28.890301+00:00'
summary: Adaptive token budget based on project complexity
---

Adaptive token budget based on project complexity
## Context
SessionStart context injection must balance providing useful context without overwhelming Claude's context window.

## Rationale
- Simple projects (<10 memories): 500 tokens
- Medium (10-50 memories): 1000 tokens
- Complex (50-100 memories): 2000 tokens
- Full (>100 memories): 3000 tokens
- Proportional allocation: 50% blockers, 40% decisions, 10% actions

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:145-183
- src/git_notes_memory/hooks/context_builder.py:186-221
- src/git_notes_memory/config.py:536-539

---
type: decisions
timestamp: '2025-12-21T06:05:33.081889+00:00'
summary: '...memories**: Use markers anywhere in your messages:'
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...

---
type: decisions
timestamp: '2025-12-21T06:05:33.102411+00:00'
summary: Git notes as source of truth, SQLite as derived queryable index
---

Git notes as source of truth, SQLite as derived queryable index
## Context
Core architectural decision for the memory storage system. Git notes provide distributed, versioned storage that syncs with code, while SQLite + sqlite-vec provides fast KNN search.

## Rationale
- Git notes are inherently distributed (push/pull with repos)
- Version history comes free with git
- Index can be rebuilt from notes (SyncService.reindex)
- sqlite-vec enables local semantic search without external APIs

## Related Files
- docs/spec/completed/2025-12-18-memory-capture-plugin/ARCHITECTURE.md:85-91
- src/git_notes_memory/git_ops.py:1-50
- src/git_notes_memory/sync.py:1-50

---
type: decisions
timestamp: '2025-12-21T06:05:33.123953+00:00'
summary: Lazy loading via __getattr__ to avoid embedding model import penalty
---

Lazy loading via __getattr__ to avoid embedding model import penalty
## Context
The sentence-transformers embedding model adds 2-3 seconds to import time. SessionStart hooks must complete quickly (<5s) to avoid blocking Claude Code sessions.

## Rationale
- Defer all expensive imports until first use
- Factory functions (`get_capture_service()`) create singletons lazily
- Direct SQLite queries in session_start_handler avoid full IndexService initialization

## Related Files
- src/git_notes_memory/__init__.py:27-85
- src/git_notes_memory/hooks/session_start_handler.py:66-89

---
type: decisions
timestamp: '2025-12-21T06:05:33.142973+00:00'
summary: Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
---

Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
## Context
When detecting capture-worthy content, the system needs to balance automation with user control.

## Rationale
- ≥0.95 confidence → AUTO (capture silently, show notification)
- 0.70-0.95 → SUGGEST (show suggestion, user confirms)
- <0.70 → SKIP (no action unless explicit marker)
- Explicit markers like `[decision]` always treated as confidence 0.98-1.0

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:226-265
- src/git_notes_memory/hooks/capture_decider.py:128-200

---
type: decisions
timestamp: '2025-12-21T06:05:33.162130+00:00'
summary: Adaptive token budget based on project complexity
---

Adaptive token budget based on project complexity
## Context
SessionStart context injection must balance providing useful context without overwhelming Claude's context window.

## Rationale
- Simple projects (<10 memories): 500 tokens
- Medium (10-50 memories): 1000 tokens
- Complex (50-100 memories): 2000 tokens
- Full (>100 memories): 3000 tokens
- Proportional allocation: 50% blockers, 40% decisions, 10% actions

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:145-183
- src/git_notes_memory/hooks/context_builder.py:186-221
- src/git_notes_memory/config.py:536-539

---
type: decisions
timestamp: '2025-12-21T06:05:47.417871+00:00'
summary: '...memories**: Use markers anywhere in your messages:'
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...

---
type: decisions
timestamp: '2025-12-21T06:05:47.444336+00:00'
summary: Git notes as source of truth, SQLite as derived queryable index
---

Git notes as source of truth, SQLite as derived queryable index
## Context
Core architectural decision for the memory storage system. Git notes provide distributed, versioned storage that syncs with code, while SQLite + sqlite-vec provides fast KNN search.

## Rationale
- Git notes are inherently distributed (push/pull with repos)
- Version history comes free with git
- Index can be rebuilt from notes (SyncService.reindex)
- sqlite-vec enables local semantic search without external APIs

## Related Files
- docs/spec/completed/2025-12-18-memory-capture-plugin/ARCHITECTURE.md:85-91
- src/git_notes_memory/git_ops.py:1-50
- src/git_notes_memory/sync.py:1-50

---
type: decisions
timestamp: '2025-12-21T06:05:47.469143+00:00'
summary: Lazy loading via __getattr__ to avoid embedding model import penalty
---

Lazy loading via __getattr__ to avoid embedding model import penalty
## Context
The sentence-transformers embedding model adds 2-3 seconds to import time. SessionStart hooks must complete quickly (<5s) to avoid blocking Claude Code sessions.

## Rationale
- Defer all expensive imports until first use
- Factory functions (`get_capture_service()`) create singletons lazily
- Direct SQLite queries in session_start_handler avoid full IndexService initialization

## Related Files
- src/git_notes_memory/__init__.py:27-85
- src/git_notes_memory/hooks/session_start_handler.py:66-89

---
type: decisions
timestamp: '2025-12-21T06:05:47.488552+00:00'
summary: Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
---

Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
## Context
When detecting capture-worthy content, the system needs to balance automation with user control.

## Rationale
- ≥0.95 confidence → AUTO (capture silently, show notification)
- 0.70-0.95 → SUGGEST (show suggestion, user confirms)
- <0.70 → SKIP (no action unless explicit marker)
- Explicit markers like `[decision]` always treated as confidence 0.98-1.0

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:226-265
- src/git_notes_memory/hooks/capture_decider.py:128-200

---
type: decisions
timestamp: '2025-12-21T06:05:47.507345+00:00'
summary: Adaptive token budget based on project complexity
---

Adaptive token budget based on project complexity
## Context
SessionStart context injection must balance providing useful context without overwhelming Claude's context window.

## Rationale
- Simple projects (<10 memories): 500 tokens
- Medium (10-50 memories): 1000 tokens
- Complex (50-100 memories): 2000 tokens
- Full (>100 memories): 3000 tokens
- Proportional allocation: 50% blockers, 40% decisions, 10% actions

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:145-183
- src/git_notes_memory/hooks/context_builder.py:186-221
- src/git_notes_memory/config.py:536-539

---
type: decisions
timestamp: '2025-12-21T06:10:03.879629+00:00'
summary: '...memories**: Use markers anywhere in your messages:'
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...

---
type: decisions
timestamp: '2025-12-21T06:10:03.901593+00:00'
summary: Git notes as source of truth, SQLite as derived queryable index
---

Git notes as source of truth, SQLite as derived queryable index
## Context
Core architectural decision for the memory storage system. Git notes provide distributed, versioned storage that syncs with code, while SQLite + sqlite-vec provides fast KNN search.

## Rationale
- Git notes are inherently distributed (push/pull with repos)
- Version history comes free with git
- Index can be rebuilt from notes (SyncService.reindex)
- sqlite-vec enables local semantic search without external APIs

## Related Files
- docs/spec/completed/2025-12-18-memory-capture-plugin/ARCHITECTURE.md:85-91
- src/git_notes_memory/git_ops.py:1-50
- src/git_notes_memory/sync.py:1-50

---
type: decisions
timestamp: '2025-12-21T06:10:03.921658+00:00'
summary: Lazy loading via __getattr__ to avoid embedding model import penalty
---

Lazy loading via __getattr__ to avoid embedding model import penalty
## Context
The sentence-transformers embedding model adds 2-3 seconds to import time. SessionStart hooks must complete quickly (<5s) to avoid blocking Claude Code sessions.

## Rationale
- Defer all expensive imports until first use
- Factory functions (`get_capture_service()`) create singletons lazily
- Direct SQLite queries in session_start_handler avoid full IndexService initialization

## Related Files
- src/git_notes_memory/__init__.py:27-85
- src/git_notes_memory/hooks/session_start_handler.py:66-89

---
type: decisions
timestamp: '2025-12-21T06:10:03.941837+00:00'
summary: Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
---

Confidence-based tiered capture behavior (AUTO/SUGGEST/SKIP)
## Context
When detecting capture-worthy content, the system needs to balance automation with user control.

## Rationale
- ≥0.95 confidence → AUTO (capture silently, show notification)
- 0.70-0.95 → SUGGEST (show suggestion, user confirms)
- <0.70 → SKIP (no action unless explicit marker)
- Explicit markers like `[decision]` always treated as confidence 0.98-1.0

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:226-265
- src/git_notes_memory/hooks/capture_decider.py:128-200

---
type: decisions
timestamp: '2025-12-21T06:10:03.961280+00:00'
summary: Adaptive token budget based on project complexity
---

Adaptive token budget based on project complexity
## Context
SessionStart context injection must balance providing useful context without overwhelming Claude's context window.

## Rationale
- Simple projects (<10 memories): 500 tokens
- Medium (10-50 memories): 1000 tokens
- Complex (50-100 memories): 2000 tokens
- Full (>100 memories): 3000 tokens
- Proportional allocation: 50% blockers, 40% decisions, 10% actions

## Related Files
- docs/spec/completed/2025-12-19-hook-based-memory-capture/DECISIONS.md:145-183
- src/git_notes_memory/hooks/context_builder.py:186-221
- src/git_notes_memory/config.py:536-539

---
type: decisions
timestamp: '2025-12-21T06:10:55.728727+00:00'
summary: '...memories**: Use markers anywhere in your messages:'
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...

---
type: decisions
timestamp: '2025-12-21T06:12:34.367482+00:00'
summary: '...memories**: Use markers anywhere in your messages:'
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...

---
type: decisions
timestamp: '2025-12-21T06:19:35.947713+00:00'
summary: '...patterns and base confidence'
tags:
- auto-captured
- post-tool-use
- file:RESEARCH_NOTES.md
---

...patterns and base confidence
- Block markers: `▶ namespace ─────────────────`
- Inline markers: `[decision]`, `[learned]`, `[blocker]`
- Contextual patterns: "I decided", "TIL", "blocked by"

**Real...

---
type: decisions
timestamp: '2025-12-21T06:21:54.889909+00:00'
summary: Use PostgreSQL for persistence layer
tags:
- auto-captured
- post-tool-use
- file:RESEARCH_REPORT.md
---

Use PostgreSQL for persistence layer
## Context
Evaluated SQLite, PostgreSQL, and MongoDB.

## Rationale
- ACID guarantees required for financial data
- Team expertise in PostgreSQL

---
type: decisions
timestamp: '2025-12-21T06:21:54.912134+00:00'
summary: '...52886bb605c8.jsonl'
tags:
- auto-captured
- post-tool-use
- file:RESEARCH_REPORT.md
---

...52886bb605c8.jsonl
Found 5 signals in transcript
  Signal: type=decision, ns=decisions, conf=1.00, match=[decision]...
  Signal: type=decision, ns=decisions, conf=0.99, match=▶ decision ───...
  Signal: type=decision...

---
type: decisions
timestamp: '2025-12-21T06:21:54.932116+00:00'
summary: Use PostgreSQL for JSONB support
tags:
- auto-captured
- post-tool-use
- file:RESEARCH_REPORT.md
---

Use PostgreSQL for JSONB support
## Context
    Why this decision was needed...

    ## Rationale
    - Reason 1 with supporting evidence
    - Alternative considered and why rejected
    ────────────────────────────────────────────────
    ```
  </mandatory_rules>
</session_behavior_protocol>
```

This teaches the LLM the capture syntax, enabling it to actively create memories during sessions.

### 6.3 Token Budget Adaptation

Context injection adapts to project complexity:

| Complexity | Memory Count | Token Budget | Working % | Semantic % |
|------------|--------------|--------------|-----------|------------|
| Simple | < 10 | 500 | 70% | 20% |
| Medium | 10-50 | 1000 | 70% | 20% |
| Complex | 50-200 | 2000 | 70% | 25% |
| Full | > 200 | 3500 | 60% | 35% |

---

## 7. Claude Skills Integration

### 7.1 Skill-Based Memory Commands

The system exposes memory operations as Claude Code skills:

| Skill | Trigger | Action |
|-------|---------|--------|
| `/memory:capture` | "Remember this" | Manual memory creation |
| `/memory:recall` | "What did we decide about..." | Semantic search |
| `/memory:search` | "Find memories about..." | Advanced search |
| `/memory:sync` | "Sync memory index" | Reindex from git notes |
| `/memory:status` | "Memory status" | Index statistics |

### 7.2 Skill Prompt Example

**User**: `/memory:recall database architecture`

**System executes**:
```python
results = recall_service.search("database architecture", k=5)
for r in results:
    print(f"{r.memory.id}: {r.memory.summary} (distance={r.distance:.3f})")
```

**Output**:
```
decisions:5da308d:18: Git notes as source of truth, SQLite as derived queryable index (0.234)
decisions:abc123:5: Use PostgreSQL for persistence layer (0.312)
learnings:def456:2: SQLite FTS5 vs sqlite-vec trade-offs (0.387)
```

### 7.3 Active Memory Enrichment

The response guidance teaches Claude to actively enrich memory:

1. **Proactive Capture**: When making decisions, Claude outputs block markers
2. **Memory Reference**: When memories are relevant, Claude cites them: "Based on a previous decision (decisions:5da308d:18)..."
3. **Git Commit Tracing**: Memory IDs contain commit SHAs for implementation context

---

## 8. Novel Use Cases

### 8.1 Cross-Session Architectural Continuity

**Scenario**: Developer asks about database choice in new session

**Memory Context** (injected at SessionStart):
```xml
<memory id="decisions:5da308d:18">
  <summary>Git notes as source of truth, SQLite as derived queryable index</summary>
</memory>
```

**LLM Response**: "Based on a previous architectural decision (decisions:5da308d:18), we chose to use git notes as the source of truth with SQLite as a derived index for search performance."

### 8.2 Blocker Resolution Tracking

**Session 1** (captured):
```
▶ blocker ─────────────────────────────────────
Hook-based memory capture not working

## Context
User outputs 16 block markers but /memory:status shows 0 memories.

## Impact
5 hours of exploration produced no captured memories.

---
type: decisions
timestamp: '2025-12-21T06:21:54.970290+00:00'
summary: '...---------|------------|------------------|'
tags:
- auto-captured
- post-tool-use
- file:RESEARCH_REPORT.md
---

...---------|------------|------------------|
| Block marker (▶) | 0.99 | None (maximum) |
| Explicit ([decision]) | 0.95-0.98 | None |
| Strong ("I decided") | 0.85-0.92 | +0.05 if "critical", "important"...

---
type: decisions
timestamp: '2025-12-21T06:21:57.978379+00:00'
summary: '...memories**: Use markers anywhere in your messages:

  - `[remember] <insight>` - Captures a learn...'
tags:
- auto-captured
- pre-compact
---

...memories**: Use markers anywhere in your messages:
- `[remember] <insight>` - Captures a learning
- `[decision] <choice>` - Captures a decision
- `/memory:capture <namespace> <content>` - Explicit capture

**Available...
